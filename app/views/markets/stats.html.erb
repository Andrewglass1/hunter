<h1> <%= @market.name %> Statistics</h1>
<%= link_to "Back to Map", market_path(@market) %>
</br>
</br>

<table class="table table-striped pretty">
  <tbody>
    <tr>
		<td><div id="this_market_categories"></div></td>
		<td><div id="all_market_categories"></div></td>
	</tr>
  </tbody>
</table>



<script type="text/javascript">
  window.onload = function () {

  //categories by market

    /* Title settings */    
  title = "<%= @market.name %>" + " Revenues By Category";
  titleXpos = 480;
  titleYpos = 85;

/* Pie Data */
  pieRadius = 130;
  pieXpos = 150;
  pieYpos = 180;

  pieData = <%=raw @market.graphael_data[0] %>;
  pieLegend = <%=raw @market.graphael_data[1] %>;
  
  pieLegendPos = "east";  
  
      var r = Raphael("this_market_categories");

      r.g.text(titleXpos, titleYpos, title).attr({"font-size": 20});
      
      var pie = r.g.piechart(pieXpos, pieYpos, pieRadius, pieData, {legend: pieLegend, legendpos: pieLegendPos});
      pie.hover(function () {
          this.sector.stop();
          this.sector.scale(1.1, 1.1, this.cx, this.cy);
          if (this.label) {
              this.label[0].stop();
              this.label[0].scale(1.5);
              this.label[1].attr({"font-weight": 800});
          }
      }, function () {
          this.sector.animate({scale: [1, 1, this.cx, this.cy]}, 500, "bounce");
          if (this.label) {
              this.label[0].animate({scale: 1}, 500, "bounce");
              this.label[1].attr({"font-weight": 400});
          }
      });

   //all categories
  
    /* Title settings */    
  AMtitle = "All Markets Revenues By Category";
  AMtitleXpos = 480;
  AMtitleYpos = 85;

	/* Pie Data */
  AMpieRadius = 130;
  AMpieXpos = 150;
  AMpieYpos = 180;

  AMpieData = <%=raw Market.graphael_data[0] %>;
  console.log(AMpieData)
  AMpieLegend = <%=raw Market.graphael_data[1] %>;
  
  AMpieLegendPos = "east";  
  
      var r = Raphael("all_market_categories");
       
      r.g.text(AMtitleXpos, AMtitleYpos, AMtitle).attr({"font-size": 20});
      
      var pie = r.g.piechart(AMpieXpos, AMpieYpos, AMpieRadius, AMpieData, {legend: AMpieLegend, AMlegendpos: AMpieLegendPos});
      pie.hover(function () {
          this.sector.stop();
          this.sector.scale(1.1, 1.1, this.cx, this.cy);
          if (this.label) {
              this.label[0].stop();
              this.label[0].scale(1.5);
              this.label[1].attr({"font-weight": 800});
          }
      }, function () {
          this.sector.animate({scale: [1, 1, this.cx, this.cy]}, 500, "bounce");
          if (this.label) {
              this.label[0].animate({scale: 1}, 500, "bounce");
              this.label[1].attr({"font-weight": 400});
          }
      });
  };
</script>